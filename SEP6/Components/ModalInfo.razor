@using SEP6.Models
@using SEP6.Serivces
@inject IMovieService MovieService

<div>
	<Space>
		<SpaceItem>
			<Tooltip Title="@("Add to favorites")">
			<Rate Character="@favorite" Count="1"  ValueChanged="onFavorite" Style="color:red" />
			</Tooltip>
		</SpaceItem>
		<SpaceItem>
			<Button Icon="@IconType.Outline.Comment" Style="width:40px; height:40px" OnClick="@(()=>{_visible = true; })" />
		</SpaceItem>
	</Space>
	<Rate ValueChanged="onRating" Style="float:right" DefaultValue="5"/>
</div>

<div style="padding-top:10px">
	<Row>
		<Col Span="12">
			<iframe height="320" width="450" src="https://www.youtube.com/embed/@(Movie.Trailer)" />
		</Col>
		<Col Span="12">
			<Descriptions Title="Movie info" Bordered Column="@column">
				<DescriptionsItem Title="Director">@Movie.Director</DescriptionsItem>
				<DescriptionsItem Title="Genre">
					@foreach (var genre in Movie.Genres){
					<Tag>@genre</Tag>
					}
				</DescriptionsItem>
				<DescriptionsItem Title="Actors">
					@foreach (var item in Movie.Actors)
					{
						<Tag>@item</Tag>
					}
				</DescriptionsItem>
			</Descriptions>
		</Col>
	</Row>
</div>

<Modal 
    Title="@Movie.Title"
    Visible="@_visible"
	Footer="null"
	OnCancel="@(()=>{ _visible = false; })"
	Width="1000"
>
    <AntList DataSource="@reviews" Class="comment-list">
		<ListItem >
			<Comment  Avatar="context.Avatar" Author="context.Author" Content="context.Content"></Comment>
		</ListItem>
	</AntList>
	<div>
        <TextArea MinRows="4" @bind-Value="@_value" />
        <br/>
        <br/>
        <Button Loading="@submitting" OnClick="onSubmit " type="primary">
            Add Comment
        </Button>
    </div>
</Modal>

@code {
	private MovieData Movie = new MovieData();
	private List<MovieReview> reviews = new List<MovieReview>();
	private string _value = "";
	bool _visible = false;
	bool like = false;
    bool dislike = false;
	bool submitting = false;

	RenderFragment<RateItemRenderContext> favorite = (builder) =>
	@<Template>
		<Icon Type="heart" Theme="fill" Style="font-size:40px" />
	</Template>
	;

	/*RenderFragment likeAction=>
        @<span>
            <Tooltip Title="@("Like")">
                <Icon Type="like" Theme="@(like ? "fill" : "outline")" OnClick="SetLike" />
            </Tooltip>
            <span>@(like ? 1 : 0)</span>
        </span>;

    RenderFragment dislikeAction=>
        @<span>
            <Tooltip Title="@("Dislike")">
                <Icon Type="dislike" Theme="@(dislike ? "fill" : "outline")" OnClick="SetDislike" />
            </Tooltip>
            <span>@(dislike ? 1:0)</span>
        </span>;*/

	protected override void OnInitialized()
    {
        Movie = MovieService.GetMovie();
    }
	
	void onFavorite(decimal value)
	{
		
	}
	
	void onRating(decimal value)
	{

	}

	async void onSubmit()
    {
		submitting = true;
		await Task.Delay(1000);
		submitting = false; 
		await InvokeAsync(StateHasChanged);
    }
	
	private Dictionary<string, int> column = new Dictionary<string, int> {
            { "xxl", 1 },
            { "xl", 1},
            { "lg", 1},
            { "md", 1},
            { "sm", 1},
            { "xs", 1}
        };
}
